const projectData = {
  'projectName': 'é¡¹ç›®',
  'startDate': '2021-08-01T00:00:00.000+0800',
  'endDate': '2022-08-31T00:00:00.000+0800',
  'status': 1,
  'actuleRatio': 7.0000,
  'emergencyDegree': 1,
  'engineeringScheduleList': [{
    'engineeringScheduleId': 14116,
    'milestoneId': 916,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹1',
    'startDate': '2021-08-01T00:00:00.000+0800',
    'endDate': '2021-08-31T00:00:00.000+0800',
    'status': 1,
    'actuleRatio': 10.000,
    'emergencyDegree': 1,
    'actualScheduleWorkday': 3,
    'planningScheduleWorkDays': 31,
    'processSchedules': [{
      'processScheduleId': 579,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº1-1ğŸ˜‚ğŸ˜„',
      'startDate': '2021-08-01T00:00:00.000+0800',
      'endDate': '2021-08-31T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }]
  }, {
    'engineeringScheduleId': 14132,
    'milestoneId': 916,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹2ğŸ˜‚ğŸ˜‚',
    'startDate': '2021-08-01T00:00:00.000+0800',
    'endDate': '2021-08-31T00:00:00.000+0800',
    'status': 2,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 8,
    'planningScheduleWorkDays': 133,
    'processSchedules': [{
      'processScheduleId': 594,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº2-1',
      'startDate': '2021-08-01T00:00:00.000+0800',
      'endDate': '2021-08-31T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }, {
      'processScheduleId': 593,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº2-2',
      'startDate': '2021-08-04T00:00:00.000+0800',
      'endDate': '2021-08-05T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }]
  }, {
    'engineeringScheduleId': 14131,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹3',
    'startDate': '2021-08-09T00:00:00.000+0800',
    'endDate': '2022-08-31T00:00:00.000+0800',
    'status': 2,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 7,
    'planningScheduleWorkDays': 18,
    'processSchedules': [{
      'processScheduleId': 592,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº3-1',
      'startDate': '2021-08-08T00:00:00.000+0800',
      'endDate': '2021-08-16T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }]
  }, {
    'engineeringScheduleId': 14136,
    'milestoneId': 916,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹4',
    'startDate': '2021-08-11T00:00:00.000+0800',
    'endDate': '2021-08-31T00:00:00.000+0800',
    'status': 2,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 1,
    'planningScheduleWorkDays': 7,
    'processSchedules': [{
      'processScheduleId': 595,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº4-1',
      'startDate': '2021-08-11T00:00:00.000+0800',
      'endDate': '2021-08-11T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }]
  }, {
    'engineeringScheduleId': 14137,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹5',
    'startDate': '2021-08-11T00:00:00.000+0800',
    'endDate': '2022-08-31T00:00:00.000+0800',
    'status': 0,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 0,
    'processSchedules': []
  }, {
    'engineeringScheduleId': 14138,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹6',
    'startDate': '2021-08-11T00:00:00.000+0800',
    'endDate': '2022-08-31T00:00:00.000+0800',
    'status': 1,
    'actuleRatio': 3.0000,
    'emergencyDegree': 1,
    'actualScheduleWorkday': 6,
    'planningScheduleWorkDays': 204,
    'processSchedules': [{
      'processScheduleId': 634,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº6-1',
      'startDate': '2021-08-11T00:00:00.000+0800',
      'endDate': '2021-08-19T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }, {
      'processScheduleId': 640,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº6-2',
      'startDate': '2021-08-11T00:00:00.000+0800',
      'endDate': '2021-10-11T00:00:00.000+0800',
      'status': 1,
      'actuleRatio': 3.0000,
      'emergencyDegree': 1
    }]
  }, {
    'engineeringScheduleId': 14182,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹7',
    'startDate': '2021-08-20T00:00:00.000+0800',
    'endDate': '2022-08-31T00:00:00.000+0800',
    'status': 0,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 0,
    'processSchedules': []
  }, {
    'engineeringScheduleId': 14183,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹8',
    'startDate': '2021-08-23T00:00:00.000+0800',
    'endDate': '2021-10-31T00:00:00.000+0800',
    'status': 1,
    'actuleRatio': 0.000,
    'emergencyDegree': 1,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 78,
    'processSchedules': [{
      'processScheduleId': 649,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº8-1',
      'startDate': '2021-08-23T00:00:00.000+0800',
      'endDate': '2021-09-30T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }]
  }, {
    'engineeringScheduleId': 14184,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹9',
    'startDate': '2021-08-24T00:00:00.000+0800',
    'endDate': '2021-12-31T00:00:00.000+0800',
    'status': 1,
    'actuleRatio': 21.0000,
    'emergencyDegree': 1,
    'actualScheduleWorkday': 13,
    'planningScheduleWorkDays': 62,
    'processSchedules': [{
      'processScheduleId': 655,
      'processScheduleName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥åº9-1',
      'startDate': '2021-08-24T00:00:00.000+0800',
      'endDate': '2021-10-24T00:00:00.000+0800',
      'status': 2,
      'actuleRatio': null,
      'emergencyDegree': 0
    }]
  }, {
    'engineeringScheduleId': 14185,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹10',
    'startDate': '2021-08-24T00:00:00.000+0800',
    'endDate': '2021-11-30T00:00:00.000+0800',
    'status': 0,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 0,
    'processSchedules': []
  }, {
    'engineeringScheduleId': 14352,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹11',
    'startDate': '2021-10-13T00:00:00.000+0800',
    'endDate': '2022-08-31T00:00:00.000+0800',
    'status': 0,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 0,
    'processSchedules': []
  }, {
    'engineeringScheduleId': 14355,
    'milestoneId': 0,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹12',
    'startDate': '2021-10-14T00:00:00.000+0800',
    'endDate': '2022-08-31T00:00:00.000+0800',
    'status': 0,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 0,
    'processSchedules': []
  }, {
    'engineeringScheduleId': 14504,
    'milestoneId': 917,
    'engineeringName': 'é¾™æ¹–é›†å›¢:è‡ªå»ºå·¥ç¨‹13',
    'startDate': '2021-10-25T00:00:00.000+0800',
    'endDate': '2021-12-30T00:00:00.000+0800',
    'status': 0,
    'actuleRatio': null,
    'emergencyDegree': 0,
    'actualScheduleWorkday': 0,
    'planningScheduleWorkDays': 0,
    'processSchedules': []
  }],
  'projectMilestoneList': [{
    'name': 'å¼€å·¥',
    'code': '7',
    'deadline': '2021-08-01T00:00:00.000+0800',
    'emergencyDegree': 0,
    'milestoneRate': 0
  }, {
    'name': 'å‡ºÂ±0',
    'code': '1',
    'deadline': '2021-11-23T00:00:00.000+0800',
    'emergencyDegree': 1,
    'milestoneRate': 0.0702
  }, {
    'name': 'ä¸»ä½“ç»“æ„å®Œæˆ',
    'code': '2',
    'deadline': '2021-12-30T00:00:00.000+0800',
    'emergencyDegree': 0,
    'milestoneRate': 0
  }]
};

let engineeringScheduleList = projectData.engineeringScheduleList.map((item) => ({
  ...item,
  _type: 'engineering',
  _id: item.engineeringScheduleId,
  _name: item.engineeringName,
  _isExpanded: false,
  processSchedules: item.processSchedules.map((processItem) => ({
    ...processItem,
    _type: 'process',
    _id: processItem.processScheduleId,
    _parentId: item.engineeringScheduleId,
    _name: processItem.processScheduleName,
    _isExpanded: false,
  })),
}));
const projectMilestoneList = [...projectData.projectMilestoneList.map((item) => ({
  name: item.name,
  xAxis: new Date(item.deadline).getTime(),
})), {
  name: 'ä»Šæ—¥',
  xAxis: new Date().getTime(),
}];

// è®°ä½datazoomçš„xè½´åç§»é‡
let dataZoomStart = 0;
const valueSpanIndex = 5;

const renderChart = start => {
  // dataZoom
  const dayTimestamp = 24 * 60 * 60 * 1000;
  // å…¨å±æ—¶æ‰‹åŠ¿æ›´æ”¹çš„æ—¶é—´èŒƒå›´
  const VALUE_SPAN_ARRAY = Array.from({ length: 6 }, (_, i) => dayTimestamp * 30 * 6.5 / Math.pow(2, 5 - i));
  const dataZoomX = [
    {
      type: 'slider',
      show: false,
      filterMode: 'none', // ä¸è¿‡æ»¤æ•°æ®ï¼Œåªæ”¹å˜æ•°è½´èŒƒå›´ã€‚
      xAxisIndex: [0, 1],
      start,
      // end: 100,
      // åæ ‡è½´ä¸Šæœ€å¤§å’Œæœ€å°é—´éš”ç›¸åŒ ä¿è¯å›ºå®šå±•ç¤ºæ•°é‡ ä¸”.5å¸¦æ¥å¯æ»‘åŠ¨çš„è§‚æ„Ÿ
      minValueSpan: VALUE_SPAN_ARRAY[valueSpanIndex],
      maxValueSpan: VALUE_SPAN_ARRAY[valueSpanIndex],
    },
    {
      id: 'zoomX',
      type: 'inside',
      filterMode: 'none',
      xAxisIndex: [0, 1],
      zoomLock: true,
      preventDefaultMouseMove: false,
    },
  ];
  const dataZoomY = [
    {
      type: 'slider',
      show: false,
      filterMode: 'none', // ä¸è¿‡æ»¤æ•°æ®ï¼Œåªæ”¹å˜æ•°è½´èŒƒå›´ã€‚
      yAxisIndex: 0,
      // å…¨å±æ—¶Yè½´å¯ä»¥æ»‘åŠ¨
      minValueSpan: window.innerHeight / 80,
      maxValueSpan: window.innerHeight / 80,
    },
    {
      type: 'inside',
      filterMode: 'none',
      yAxisIndex: 0,
      zoomLock: true,
      // å…¨å±æ—¶Yè½´å¯ä»¥æ»‘åŠ¨
      moveOnMouseMove: true,
      preventDefaultMouseMove: true,
    }
  ];
  const dataZoom = [
    ...dataZoomX,
    ...dataZoomY,
  ];
  
  // grid
  const FULLSCREEN_GRID_LEFT = 210;
  // ä¸ºäº†å…¨å±æ—¶å·¦ä¾§è®¾ç½®èƒŒæ™¯è‰² å°†å·¦å³ä¸¤ä¾§æ–¹å‘è®¾ç½®0
  const grid = {
    top: 6,
    right: 0,
    bottom: 0,
    left: FULLSCREEN_GRID_LEFT,
    containLabel: true,
  };
  
  // xAxis
  const xAxisMin = new Date(new Date(projectData.startDate).setDate(1)).getTime(); // å½“æœˆ1å·
  const xAxisBase = {
    type: 'time',
    position: 'top',
    // z: 10,
    min: xAxisMin,
    // min: 1609430400000, // 2021-01-01
    // max: 1640880000000, // 2021-12-31
    axisLabel: {
      margin: 6,
      formatter: '{yyyy}.{MM}',
      color: '#6F6F6F',
      fontSize: 10,
      align: 'left',
    },
    axisLine: {
      show: false,
    },
    axisTick: {
      show: false,
    },
    splitArea: {
      show: false,
    },
  };
  const xAxis = [
    {
      ...xAxisBase,
      minInterval: dayTimestamp * 7,
      // maxInterval: dayTimestamp * 7,
      // splitNumber: 3,
      axisLabel: {
        show: true,
        margin: 12,
        // formatter: '{yyyy}.{MM}',
        formatter() {
          return valueSpanIndex >= 5 ? '{yyyy}.{MM}' : '{yyyy}.{MM}.{dd}';
        },
        hideOverlap: true, // é¿å…é‡å 
        color: '#848484',
        fontSize: 10,
        align: 'left',
      },
      axisLine: {
        show: true,
        lineStyle: {
          color: '#DCDFE7',
          width: 18,
          cap: 'butt',
        },
      },
    },
    {
      ...xAxisBase,
      offset: 28,
      // æ—¶é—´åŒºé—´è¾ƒå°æ—¶(valueSpanIndex <= 3) ç›´æ¥èµ‹å€¼splitNumberæœ€å° é¿å…å±•ç¤ºè¿‡å¤š è¿™é‡Œæœ€å¥½è¿˜æ˜¯æŠŠå­£åº¦å»æ‰ æ²¡æœ‰ä»»ä½•æ„ä¹‰
      minInterval: valueSpanIndex > 3 ? dayTimestamp * 30 * 4 : undefined,
      maxInterval: valueSpanIndex > 3 ? dayTimestamp * 30 * 4 : undefined,
      splitNumber: valueSpanIndex <= 3 && 1,
      axisLabel: {
        margin: 4,
        // echartsè‡ªå¸¦å­£åº¦æœ‰bug
        // formatter: 'Q{Q}',
        formatter(value) {
          const month = new Date(value).getMonth();
          if (month < 3) {
            return 'Q1';
          } else if (month < 6) {
            return 'Q2';
          } else if (month < 9) {
            return 'Q3';
          } else {
            return 'Q4';
          }
        },
        // showMinLabel: false,
        // showMaxLabel: false,
        color: '#848484',
        fontSize: 12,
        align: 'left',
      },
      axisLine: {
        show: true,
        lineStyle: {
          color: '#EAEAEA',
          width: 0.5,
        },
      },
    },
  ];
  
  // yAxis
  const yAxis = {
    // è¿™é‡Œè®¾ç½®falseä¼šå½±å“splitAreaå±•ç¤º
    // show: false,
    // è¿™è¡Œdataå»æ‰æ»‘åŠ¨å°±å¾ˆé¡ºç•… é€šè¿‡min & maxå‚æ•°å®šä¹‰Yè½´
    // data: engineeringScheduleList.value.map((item) => item._name),
    inverse: true,
    interval: 1,
    axisLabel: {
      show: false,
    },
    axisLine: {
      show: false,
    },
    axisTick: {
      show: false,
    },
    splitLine: {
      show: false,
    },
    splitArea: {
      show: true,
      areaStyle: {
        color: engineeringScheduleList.map((item) => {
          if (item._type === 'engineering' && !item._isExpanded) {
            return 'white';
          } else {
            return item.status === 1 ? '#FFEEEE' : '#EBF3FE';
          }
        }),
      },
    },
    min: 0,
    max: engineeringScheduleList.length,
  };
  
  // series
  const STATUS_MAP = ['æœªå¼€å§‹', 'è¿›è¡Œä¸­', 'å·²å®Œå·¥', 'å¾…ç¡®è®¤', 'å·²æ‹’ç»'];
  const renderCircleItem = (isShowCircle, isExpanded, status) => {
    return {
      type: 'circle',
      z2: 3,
      textContent: {
        style: {
          y: -1.6,
          text: isExpanded ? '-' : '+',
          textFill: status === 1 ? '#FF6E6E' : '#3688F6',
          fontSize: '16px',
        },
      },
      textConfig: {
        position: 'inside',
      },
      shape: {
        // cx: 0,
        // cy: 0,
        r: 8,
      },
      style: {
        fill: status === 1 ? '#FFEEEE' : '#EBF3FE',
      },
      ignore: !isShowCircle,
    };
  };
  // for more details, see https://echarts.apache.org/examples/zh/editor.html?c=custom-gantt-flight
  const renderGanttItem = (params, api) => {
    // clip rect outside canvas when dragging!
    // function clipRectByRect(params, rect) {
    //   return echarts.graphic.clipRectByRect(rect, {
    //     x: params.coordSys.x,
    //     y: params.coordSys.y,
    //     width: params.coordSys.width,
    //     height: params.coordSys.height,
    //   });
    // }
    const yIndex = params.dataIndexInside; // yè½´æ•°æ®indexå€¼
    const { _type, _name, _isExpanded, actuleRatio: actualRatio = 0, status, processSchedules } = engineeringScheduleList[yIndex];
    const isShowCircle = _type === 'engineering' && !!processSchedules.length;
    const startDate = api.coord([api.value(0), yIndex]); // å¼€å§‹æ—¶é—´æ•°å€¼è½¬æ¢æˆåæ ‡ç³»ä¸Šçš„ç‚¹
    const endDate = api.coord([api.value(1), yIndex]); // ç»“æŸæ—¶é—´æ•°å€¼è½¬æ¢æˆåæ ‡ç³»ä¸Šçš„ç‚¹
    const barLength = endDate[0] - startDate[0]; // é•¿åº¦
    const yIntervalHeight = api.size([0, 1])[1]; // yè½´é—´éš”è·ç¦»ï¼Œå•ä½ä¸º1åº”å¾—åˆ°çš„é•¿åº¦ï¼›xè½´ä¸º0å¾—åˆ°0ç•¥è¿‡
    const barHeight = yIntervalHeight * (_type === 'engineering' ? 0.48 : 0.24); // æŸ±çŠ¶å›¾é«˜åº¦ç”±yè½´é—´éš”é«˜åº¦ä¹˜ä»¥ç³»æ•°å¾—åˆ°
    const [x, y] = startDate;
    const text = `${actualRatio || 0}% (${STATUS_MAP[status]})`;
    const textWidth = text.length * 11 + (isShowCircle ? 24 : 4); // è®¡ç®—pathçš„é•¿åº¦ è¿™é‡Œæ— æ³•æ‰¾åˆ°æ–¹æ³•è‡ªé€‚åº” within my capacity oops~
  
    return {
      type: 'group',
      id: 'ganttItem',
      position: [x, y + (yIntervalHeight - barHeight) / 2],
      children: [
        {
          type: 'rect',
          textContent: {
            style: {
              text,
              textFill: '#323232',
            },
            ignore: _type === 'process',
          },
          textConfig: {
            position: 'insideLeft',
          },
          shape: {
            width: barLength,
            height: barHeight,
            r: 3, // è®¾ç½®åœ†è§’çŸ©å½¢
          },
          style: {
            fill: status === 1 ? (_type === 'engineering' ? '#FF6E6E' : '#FFA8A8') : (_type === 'engineering' ? '#378DFF' : '#9AC3FA'),
          },
        },
        {
          type: 'rect',
          shape: {
            width: barLength * actualRatio / 100,
            height: barHeight / 3,
            r: 3, // è®¾ç½®åœ†è§’çŸ©å½¢
          },
          style: {
            fill: status === 1 ? '#E64A4A' : '#006CCF',
          },
          ignore: !actualRatio, // éå…¨å±æ—¶å±•ç¤º; å…¨å±ä¸”å‹¾é€‰å®é™…è¿›åº¦æ˜ç»†æ—¶å±•ç¤º;
        },
      ],
    };
  };
  const renderAxisLabelItem = (params, api) => {
    const yIndex = params.dataIndexInside; // yè½´æ•°æ®indexå€¼
    const { _type, _name, _isExpanded, status, processSchedules } = engineeringScheduleList[yIndex];
    const isShowCircle = _type === 'engineering' && !!processSchedules.length;
    const y = api.coord([0, api.value(0)])[1];
  
    const AXIS_LABEL_LEFT = 24;
    const AXIS_LABEL_RIGHT = 6;
    const AXIS_LABEL_HEIGHT = api.size([0, 1])[1] * 0.8;
  
    // è£æ‰è¶…å‡ºyè½´åæ ‡ç³»çš„éƒ¨åˆ†
    if (y < params.coordSys.y - AXIS_LABEL_HEIGHT) {
      return;
    }
  
    return {
      type: 'group',
      position: [AXIS_LABEL_LEFT, y + AXIS_LABEL_HEIGHT / 8 /* é«˜åº¦å æ¯”0.8 å±…ä¸­ä¸Šä¸‹å„ç•™0.1 æ‰€ä»¥é™¤ä»¥8 */],
      children: [
        _type === 'engineering' ? {
          type: 'rect',
          z2: 1,
          shape: {
            width: FULLSCREEN_GRID_LEFT - AXIS_LABEL_LEFT - AXIS_LABEL_RIGHT,
            height: AXIS_LABEL_HEIGHT,
            r: 3,
          },
          style: {
            fill: 'white',
          },
        } : {
          type: 'group',
          children: [
            {
              type: 'polyline',
              shape: {
                points: [[10, -48], [10, AXIS_LABEL_HEIGHT / 2], [16, AXIS_LABEL_HEIGHT / 2]],
              },
              style: {
                fill: 'transparent',
                stroke: '#D6D6D6',
              },
            },
            {
              type: 'circle',
              shape: {
                cx: 20,
                cy: AXIS_LABEL_HEIGHT / 2,
                r: 2,
              },
              style: {
                fill: status === 1 ? '#FF5252' : '#3688F6',
              },
            },
          ],
        },
        {
          type: 'group',
          position: [12, AXIS_LABEL_HEIGHT / 2],
          children: [
            renderCircleItem(isShowCircle, _isExpanded, status),
            {
              type: 'text',
              z2: 3,
              style: {
                x: _type === 'engineering' ? 12 : 16,
                y: -6,
                text: _name,
                textFill: _type === 'engineering' ? '#323232' : '#5B5B5B',
                fontWeight: _type === 'engineering' && 'bold',
              },
            },
          ],
        },
        {
          type: 'text',
          z2: 5,
          style: {
            x: FULLSCREEN_GRID_LEFT - AXIS_LABEL_LEFT - AXIS_LABEL_RIGHT - 12,
            y: AXIS_LABEL_HEIGHT / 2 - 8,
            text: '>',
            textFill: '#D6D6D6',
          },
        },
      ],
    };
  };
  const markLine = {
    symbol: ['emptyCircle'],
    animation: false,
    data: projectMilestoneList.map((item) => ({
      ...item,
      y: 40,
      label: {
        show: false,
        silent: true, // ä¸å“åº”å’Œè§¦å‘é¼ æ ‡äº‹ä»¶
        position: 'start',
      },
      lineStyle: {
        color: '#F2BA40',
        opacity: 0.5,
      },
      emphasis: {
        label: {
          show: true,
          opacity: 1,
          formatter(params) {
            return `{a|${params.name}}` + '\n' + `{b|${new Date(params.value).getMonth() + 1}.${new Date(params.value).getDate()}}`;
          },
          rich: {
            a: {
              color: '#464646',
              fontSize: 16,
            },
            b: {
              color: '#999',
              fontSize: 10,
              padding: [2, 0, 2, 0],
            },
          },
        },
        lineStyle: {
          color: '#205294',
        },
      },
    })),
  };
  const seriesBase = {
    type: 'custom',
    clip: true, // è£æ‰æ‰€æœ‰è¶…å‡ºåæ ‡ç³»çš„éƒ¨åˆ†
    // custom can only use Array but not Object data format! 
    // dimensions: 0 startDate 1 endDate
    data: engineeringScheduleList.map((item) => [new Date(item.startDate).getTime(), new Date(item.endDate).getTime()]),
    renderItem: renderGanttItem,
    xAxisIndex: 0,
    encode: { // ä¸å¯åˆ  å¯¹åº”zoomdata
      x: [0, 1],
      y: 0,
    },
    markLine,
  };
  const series = [
    {
      ...seriesBase,
      markLine: {
        ...markLine,
        data: markLine.data.map((item) => ({
          ...item,
          y: 44,
          emphasis: {
            label: {
              show: false,
            },
          },
        })),
      },
    },
    // just for xAxis Q1-4
    {
      type: 'custom',
      data: engineeringScheduleList.map((item) => [new Date(item.startDate).getTime(), new Date(item.endDate).getTime()]),
      renderItem: () => { return null },
      xAxisIndex: 1,
      encode: {
        x: [0, 1],
        y: 0,
      },
    },
    {
      type: 'custom',
      data: engineeringScheduleList.map((_, index) => [index]),
      renderItem: renderAxisLabelItem,
      encode: {
        x: -1,
        y: 0
      },
    },
  ];
  
  myChart.setOption({
    dataZoom,
    grid,
    xAxis,
    yAxis,
    series,
    backgroundColor: '#F8F9FB',
  });
};
const resizeChart = () => {
  setTimeout(() => {
    myChart.resize({ height: window.innerHeight });
  });
};

renderChart();
resizeChart();

myChart.on('click', 'series.custom', event => {
  // ä»…å·¥ç¨‹å·¥åºé¡¹
  if (event.componentSubType !== 'custom') return;
  const index = event.dataIndex;
  const selectedItem = engineeringScheduleList[index];
  if (selectedItem._type === 'engineering') {
    // å·¥ç¨‹ä¸‹æ— å·¥åºæƒ…å†µ
    if (!selectedItem.processSchedules.length) return;

    if (selectedItem._isExpanded) {
      engineeringScheduleList = engineeringScheduleList.filter(item => item._parentId !== selectedItem._id);
    } else {
      engineeringScheduleList.splice(index + 1, 0, ...selectedItem.processSchedules);
    }
    engineeringScheduleList[index]._isExpanded = !engineeringScheduleList[index]._isExpanded;
    renderChart(dataZoomStart);
    resizeChart();
  } else {
    emit('clickProcess', selectedItem);
  }
});
myChart.on('dataZoom', event => {
  if (!event.batch) return;
  dataZoomStart = event.batch[0].start;
});